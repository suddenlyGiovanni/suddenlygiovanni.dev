name: 🐶 reviewdog
on: pull_request
jobs:
  actionlint:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 reviewdog with actionlint
        uses: reviewdog/action-actionlint@c6ee1eb0a5d47b2af53a203652b5dac0b6c4016e # v1
        continue-on-error: true
        with:
          fail_on_error: false
          filter_mode: nofilter
          github_token: ${{ secrets.github_token }}
          level: error
          reporter: github-pr-review
          tool_name: actionlint

  hadolint:
    name: runner / hadolint
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 reviewdog with hadolint (Dockerfile)
        uses: reviewdog/action-hadolint@a5498b3af526595744db9bf22d987111aa8c4687 # v1
        continue-on-error: true
        with:
          filter_mode: nofilter
          reporter: github-pr-review
          github_token: ${{ secrets.github_token }}

  shellcheck:
    name: runner / shellcheck
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 reviewdog with shellcheck (shell)
        uses: reviewdog/action-shellcheck@72365a51bf6476fe952a117c3ff703eb7775e40a # v1
        with:
          check_all_files_with_shebangs: "true" # Optional.
          exclude: "./.git/*" # Optional.
          fail_on_error: false
          filter_mode: nofilter
          github_token: ${{ secrets.github_token }}
          path: "." # Optional.
          pattern: "*.sh" # Optional.
          reporter: github-pr-review

  shfmt:
    name: runner / shfmt
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 reviewdog with shfmt (shell)
        uses: reviewdog/action-shfmt@f59386f08bd9a24ac1a746e69f026ddc2ed06710 # v1
        continue-on-error: true
        with:
          check_all_files_with_shebangs: true
          exclude: "*/.git/*"
          fail_on_error: false
          filter_mode: nofilter
          github_token: ${{ secrets.github_token }}
          level: "warning"
          path: "."
          pattern: "*.sh"
          reporter: github-pr-review

  markdownlint:
    name: runner / markdownlint
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 reviewdog with markdownlint (markdown)
        continue-on-error: true
        uses: reviewdog/action-markdownlint@6e02140816b5fcc7295ea7ae2a664af18190ff29 # v0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          reporter: github-pr-review
          level: warning
          filter_mode: nofilter
          fail_on_error: false

  tsc:
    name: runner / tsc
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 📦 Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 8

      - name: 🛠️ Set up Node.js
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4
        with:
          node-version: current
          cache: "pnpm"

      - name: 🧩 Install dependencies
        run: pnpm install --frozen-lockfile --prod=false

      - name: 🐶 reviewdog with tsc (TypeScript) - packages/ui
        uses: EPMatt/reviewdog-action-tsc@3777408796aadf116630f57f7267909d38f9e01a # v1
        with:
          github_token: ${{ secrets.github_token }}
          workdir: "."
          level: error
          reporter: github-pr-review
          filter_mode: nofilter
          fail_on_error: false
          tsc_flags: "--noEmit --pretty --project packages/ui"

      - name: 🐶 reviewdog with tsc (TypeScript) - apps/web
        uses: EPMatt/reviewdog-action-tsc@3777408796aadf116630f57f7267909d38f9e01a # v1
        with:
          github_token: ${{ secrets.github_token }}
          workdir: "."
          level: error
          reporter: github-pr-review
          filter_mode: nofilter
          fail_on_error: false
          tsc_flags: "--noEmit --pretty --project apps/web"

  biome:
    name: runner / Biome
    runs-on: ubuntu-latest
    continue-on-error: true
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 Setup reviewdog
        uses: reviewdog/action-setup@1d18b2938261447f64c39f831d7395e90ef5a40e # v1
        with:
          reviewdog_version: latest

      - name: Setup Biome
        uses: biomejs/setup-biome@b9af8bac86b0da736cfbfadbfeb3f7463da083f2 # v2
        with:
          biome-version: latest
          token: ${{ secrets.github_token }}
          working-dir: "."
          version: "latest"

      - name: 🐶 reviewdog with Biome
        env:
          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.github_token }}
        continue-on-error: true
        shell: bash
        run: |
          biome ci --formatter-enabled=false --linter-enabled=true . 2>&1 1>/dev/null |
          sed 's/ *$//' |
          awk 'BEGIN { RS=""; ORS="\n\n" } { if (index($0, "│") > 0) { print "  ```\n" $0 "\n  ```" } else { print $0 } }' |
          reviewdog \
            -efm="%-G%f ci ━%#" \
            -efm="%-G%f lint ━%#" \
            -efm="%-Gci ━%#" \
            -efm="%E%f:%l:%c %.%#" \
            -efm="%E%f %.%#" \
            -efm="%C" \
            -efm="%C  × %m" \
            -efm="%C  %m" \
            -efm="%-G%.%#" \
            -name="Biome" \
            -reporter="github-pr-review" \
            -filter-mode="nofilter" \
            -fail-on-error="false" \
            -level="error"


  eslint:
    name: runner / eslint
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 📦 Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 8

      - name: 🛠️ Set up Node.js
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4
        with:
          node-version: current
          cache: "pnpm"

      - name: 🧩 Install dependencies
        run: pnpm install --frozen-lockfile

      - name: 🐶 reviewdog with ESLint (TypeScript) - apps/web
        uses: reviewdog/action-eslint@b3c5aa2589ed06195b52faffd3afb108c02faaf5 # v1
        continue-on-error: true
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          level: error
          reporter: github-pr-review
          filter_mode: nofilter
          fail_on_error: false
          workdir: apps/web
          eslint_flags: --ext ts,tsx ./app

      - name: 🐶 reviewdog with ESLint (TypeScript) - packages/ui
        uses: reviewdog/action-eslint@b3c5aa2589ed06195b52faffd3afb108c02faaf5 # v1
        continue-on-error: true
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          level: error
          reporter: github-pr-review
          filter_mode: nofilter
          fail_on_error: false
          workdir: packages/ui
          eslint_flags: --ext ts,tsx ./src

  misspell:
    name: runner / misspell
    continue-on-error: true
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: 🐶 reviewdog with misspell
        uses: reviewdog/action-misspell@32cdac969bc45951d79b89420a60c9b0102cf6ed # v1
        with:
          github_token: ${{ secrets.github_token }}
          locale: "US"
          level: "info"
          reporter: "github-pr-review"
          path: "."
          filter_mode: "nofilter"
          fail_on_error: "false"
